<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Python subscription example - Managed IoT Cloud Workshops</title>
    <meta name="generator" content="Hugo 0.50" />

    
    <meta name="description" content="Easy to follow, step-by-step tutorials for the Telenor Managed IoT Cloud platform.">
    
    <link rel="canonical" href="https://telenorstartiot.github.io/mic-workshops/api-workshop-3/python-subscription-example/">
    
    <meta name="author" content="Pontus Edvard Aurdal">
    

    <meta property="og:url" content="https://telenorstartiot.github.io/mic-workshops/api-workshop-3/python-subscription-example/">
    <meta property="og:title" content="Managed IoT Cloud Workshops">
    <meta property="og:image" content="https://telenorstartiot.github.io/mic-workshops/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Managed IoT Cloud Workshops">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://telenorstartiot.github.io/mic-workshops/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://telenorstartiot.github.io/mic-workshops/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://telenorstartiot.github.io/mic-workshops/fonts/icon.eot');
        src: url('https://telenorstartiot.github.io/mic-workshops/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://telenorstartiot.github.io/mic-workshops/fonts/icon.woff')
               format('woff'),
             url('https://telenorstartiot.github.io/mic-workshops/fonts/icon.ttf')
               format('truetype'),
             url('https://telenorstartiot.github.io/mic-workshops/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://telenorstartiot.github.io/mic-workshops/stylesheets/application.css">
    <link rel="stylesheet" href="https://telenorstartiot.github.io/mic-workshops/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://telenorstartiot.github.io/mic-workshops/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://telenorstartiot.github.io/mic-workshops/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="https://telenorstartiot.github.io/mic-workshops/stylesheets/custom.css">
    
    <script src="https://telenorstartiot.github.io/mic-workshops/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-#47abe2 palette-accent-#af3269">




<div class="backdrop">
  <div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
  <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Python subscription example
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/TelenorStartIoT/mic-workshops" title="@TelenorStartIoT/mic-workshops on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>

</header>

<main class="main">
  <div class="drawer">
    <nav aria-label="Navigation">
  <a href="https://telenorstartiot.github.io/mic-workshops/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://telenorstartiot.github.io/mic-workshops/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Managed IoT Cloud Workshops </strong>
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          

  <li>
    
    <a  title="Get Started" href="https://telenorstartiot.github.io/mic-workshops/get-started/">
      
      Get Started
    </a>

    
  </li>

  <li>
    
    <a  title="Workshop 1: Arduino IDE" href="https://telenorstartiot.github.io/mic-workshops/workshop-1/">
      
      Workshop 1: Arduino IDE
    </a>

    
  </li>

  <li>
    
    <a  title="Workshop 2: IMSI and IMEI" href="https://telenorstartiot.github.io/mic-workshops/workshop-2/">
      
      Workshop 2: IMSI and IMEI
    </a>

    
  </li>

  <li>
    
    <a  title="Workshop 3: Provisioning a Device" href="https://telenorstartiot.github.io/mic-workshops/workshop-3/">
      
      Workshop 3: Provisioning a Device
    </a>

    
  </li>

  <li>
    
    <a  title="Workshop 4: Program the Device" href="https://telenorstartiot.github.io/mic-workshops/workshop-4/">
      
      Workshop 4: Program the Device
    </a>

    
  </li>

  <li>
    
    <a  title="Workshop 5: Uplink Transform" href="https://telenorstartiot.github.io/mic-workshops/workshop-5/">
      
      Workshop 5: Uplink Transform
    </a>

    
  </li>

  <li>
    
    <a  title="Workshop 6: App Board" href="https://telenorstartiot.github.io/mic-workshops/workshop-6/">
      
      Workshop 6: App Board
    </a>

    
  </li>


        </ul>
        

        
        <hr>
        <span class="section">API Workshops</span>
        <ul>
          

  <li>
    
    <a  title="Get Started with the API" href="https://telenorstartiot.github.io/mic-workshops/api-get-started/">
      
      Get Started with the API
    </a>

    
  </li>

  <li>
    
    <a  title="Manifest" href="https://telenorstartiot.github.io/mic-workshops/manifest/">
      
      Manifest
    </a>

    
  </li>

  <li>
    
    <a  title="Workshop 1: Create an API Client" href="https://telenorstartiot.github.io/mic-workshops/api-workshop-1/">
      
      Workshop 1: Create an API Client
    </a>

    
  </li>

  <li>
    
    <a  title="Workshop 2: Use the API" href="https://telenorstartiot.github.io/mic-workshops/api-workshop-2/">
      
      Workshop 2: Use the API
    </a>

    
  </li>

  <li>
    
    <a class="active" title="Workshop 3: MQTT Realtime" href="https://telenorstartiot.github.io/mic-workshops/api-workshop-3/">
      
      Workshop 3: MQTT Realtime
    </a>

    
      <ul>
        
          <li class="anchor">
            <a  title="Configure MQTT Client" href="https://telenorstartiot.github.io/mic-workshops/api-workshop-3/configure-mqtt-client/">
              
              Configure MQTT Client
            </a>
          </li>
        
          <li class="anchor">
            <a  title="Create MQTT Client" href="https://telenorstartiot.github.io/mic-workshops/api-workshop-3/create-mqtt-client/">
              
              Create MQTT Client
            </a>
          </li>
        
          <li class="anchor">
            <a  title="Add Event Listeners" href="https://telenorstartiot.github.io/mic-workshops/api-workshop-3/add-event-listeners/">
              
              Add Event Listeners
            </a>
          </li>
        
          <li class="anchor">
            <a  title="Final Code" href="https://telenorstartiot.github.io/mic-workshops/api-workshop-3/final-code/">
              
              Final Code
            </a>
          </li>
        
          <li class="anchor">
            <a class="active" title="Python subscription example" href="https://telenorstartiot.github.io/mic-workshops/api-workshop-3/python-subscription-example/">
              
              Python subscription example
            </a>
          </li>
        
      </ul>
    
  </li>

  <li>
    
    <a  title="Workshop 4: Vue.js" href="https://telenorstartiot.github.io/mic-workshops/api-workshop-4/">
      
      Workshop 4: Vue.js
    </a>

    
  </li>

  <li>
    
    <a  title="Workshop 5: Vue.js Cont." href="https://telenorstartiot.github.io/mic-workshops/api-workshop-5/">
      
      Workshop 5: Vue.js Cont.
    </a>

    
  </li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/TelenorStartIoT" target="_blank" title="@TelenorStartIoT on GitHub">
              @TelenorStartIoT on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:pontus.edvard@gmail.com" title="Email of pontus.edvard@gmail.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

  </div>

  <article class="article">
    <div class="wrapper">
      <h1>Python subscription example </h1>

      <p>A bit unrelated, but here is also an example in Python that shows how you can setup MQTT subscription (using the things X509 certificate and key). You will have to download the certificate file(s) for the things that you want to listen (subscribe) to from MIC, unzip the file(s) and change the path to the certificate path and key in the script to match where you stored the unzipped result files. You will also need to download the AWS IoT root certificate found here: <a href="https://www.symantec.com/content/en/us/enterprise/verisign/roots/VeriSign-Class%203-Public-Primary-Certification-Authority-G5.pem">AWS IoT Root certificate</a> and store it as root.pem (and change the path accordingly in your script).</p>

<p><img src="https://telenorstartiot.github.io/mic-workshops/images/workshop-3-00-python-subscription-example-mic-download-certificate.png" alt="Download certificates and keys" title="Download certificates and keys" /></p>

<p>The example below shows how to subscribe to data from two different things but you can add more things if you wish by doing copy/paste of the relevant code parts.</p>

<pre><code class="language-python"># coding: latin-1
import sys
import json, requests
import xml.etree.ElementTree as ET
import calendar
from requests.auth import HTTPBasicAuth
from AWSIoTPythonSDK.MQTTLib import AWSIoTMQTTClient
import time

def customCallback(client, userdata, message):
	# Do whatever you want to do with the received data here
	print userdata
	

# Set up MQTT connection to 00001172
myAWSIoTMQTTClient1 = AWSIoTMQTTClient(&quot;00001172&quot;)
myAWSIoTMQTTClient1.configureEndpoint(&quot;a3k7odshaiipe8.iot.eu-west-1.amazonaws.com&quot;, 8883)
priv_key_name = &quot;./00001172/privkey.pem&quot;
cert_key_name = &quot;./00001172/cert.pem&quot;
myAWSIoTMQTTClient1.configureCredentials(&quot;./root.pem&quot;, priv_key_name, cert_key_name)
myAWSIoTMQTTClient1.connect()
myAWSIoTMQTTClient1.subscribe(&quot;$aws/things/00001172/shadow/update&quot;, 1, customCallback)

# Set up MQTT connection to 00001173
myAWSIoTMQTTClient2 = AWSIoTMQTTClient(&quot;00001173&quot;)
myAWSIoTMQTTClient2.configureEndpoint(&quot;a3k7odshaiipe8.iot.eu-west-1.amazonaws.com&quot;, 8883)
priv_key_name = &quot;./00001173/privkey.pem&quot;
cert_key_name = &quot;./00001173/cert.pem&quot;
myAWSIoTMQTTClient2.configureCredentials(&quot;./root.pem&quot;, priv_key_name, cert_key_name)
myAWSIoTMQTTClient2.connect()
myAWSIoTMQTTClient2.subscribe(&quot;$aws/things/00001173/shadow/update&quot;, 1, customCallback)

while True:
	time.sleep(1)

</code></pre>


      <aside class="copyright" role="note">
        
      </aside>

      <footer class="footer">
        

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://telenorstartiot.github.io/mic-workshops/api-workshop-3/final-code/" title="Final Code">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Final Code
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://telenorstartiot.github.io/mic-workshops/api-workshop-4/" title="Workshop 4: Vue.js">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Workshop 4: Vue.js
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





      </footer>
    </div>
  </article>

  <div class="results" role="status" aria-live="polite">
    <div class="scrollable">
      <div class="wrapper">
        <div class="meta"></div>
        <div class="list"></div>
      </div>
    </div>
  </div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="https://telenorstartiot.github.io/mic-workshops/javascripts/application.js"></script>
    

    <script>
      /* Add permanent link next to the headers */
      var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

      for(var i = 0; i < headers.length; i++) {
          var a = document.createElement("a");
          a.setAttribute("class", "headerlink");
          a.setAttribute("href", "#" + headers[i].id);
          a.setAttribute("title", "Permanent link")
          a.innerHTML = "#";
          headers[i].appendChild(a);
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

